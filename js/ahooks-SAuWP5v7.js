import{_ as g,a as p,b as R,c as V,d as q,e as _}from"./tslib-g6pQwBLH.js";import{d as J,t as K}from"./lodash-hv2pLSqc.js";var Q=function(e){return function(r,n){var t=React.useRef(!1);e(function(){return function(){t.current=!1}},[]),e(function(){if(!t.current)t.current=!0;else return r()},n)}},X=function(e){return typeof e=="function"};function w(e){var r=React.useRef(e);r.current=React.useMemo(function(){return e},[e]);var n=React.useRef();return n.current||(n.current=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return r.current.apply(this,t)}),n.current}const L=Q(React.useEffect);var z=function(e,r){var n=r.manual,t=r.ready,i=t===void 0?!0:t,a=r.defaultParams,o=a===void 0?[]:a,c=r.refreshDeps,s=c===void 0?[]:c,u=r.refreshDepsAction,v=React.useRef(!1);return v.current=!1,L(function(){!n&&i&&(v.current=!0,e.run.apply(e,g([],p(o),!1)))},[i]),L(function(){v.current||n||(v.current=!0,u?u():e.refresh())},g([],p(s),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};z.onInit=function(e){var r=e.ready,n=r===void 0?!0:r,t=e.manual;return{loading:!t&&n}};const Y=z;function Z(e,r){if(e===r)return!0;for(var n=0;n<e.length;n++)if(!Object.is(e[n],r[n]))return!1;return!0}function U(e,r){var n=React.useRef({deps:r,obj:void 0,initialized:!1}).current;return(n.initialized===!1||!Z(n.deps,r))&&(n.deps=r,n.obj=e(),n.initialized=!0),n.obj}function G(e){var r=React.useRef(e);return r.current=e,r}var j=function(e){var r=G(e);React.useEffect(function(){return function(){r.current()}},[])},O=new Map,I=function(e,r,n){var t=O.get(e);t?.timer&&clearTimeout(t.timer);var i=void 0;r>-1&&(i=setTimeout(function(){O.delete(e)},r)),O.set(e,R(R({},n),{timer:i}))},k=function(e){return O.get(e)},F=new Map,ee=function(e){return F.get(e)},ne=function(e,r){F.set(e,r),r.then(function(n){return F.delete(e),n}).catch(function(){F.delete(e)})},P={},re=function(e,r){P[e]&&P[e].forEach(function(n){return n(r)})},$=function(e,r){return P[e]||(P[e]=[]),P[e].push(r),function(){var t=P[e].indexOf(r);P[e].splice(t,1)}},te=function(e,r){var n=r.cacheKey,t=r.cacheTime,i=t===void 0?5*60*1e3:t,a=r.staleTime,o=a===void 0?0:a,c=r.setCache,s=r.getCache,u=React.useRef(),v=React.useRef(),d=function(f,l){c?c(l):I(f,i,l),re(f,l.data)},h=function(f,l){return l===void 0&&(l=[]),s?s(l):k(f)};return U(function(){if(n){var f=h(n);f&&Object.hasOwnProperty.call(f,"data")&&(e.state.data=f.data,e.state.params=f.params,(o===-1||new Date().getTime()-f.time<=o)&&(e.state.loading=!1)),u.current=$(n,function(l){e.setState({data:l})})}},[]),j(function(){var f;(f=u.current)===null||f===void 0||f.call(u)}),n?{onBefore:function(f){var l=h(n,f);return!l||!Object.hasOwnProperty.call(l,"data")?{}:o===-1||new Date().getTime()-l.time<=o?{loading:!1,data:l?.data,error:void 0,returnNow:!0}:{data:l?.data,error:void 0}},onRequest:function(f,l){var m=ee(n);return m&&m!==v.current?{servicePromise:m}:(m=f.apply(void 0,g([],p(l),!1)),v.current=m,ne(n,m),{servicePromise:m})},onSuccess:function(f,l){var m;n&&((m=u.current)===null||m===void 0||m.call(u),d(n,{data:f,params:l,time:new Date().getTime()}),u.current=$(n,function(E){e.setState({data:E})}))},onMutate:function(f){var l;n&&((l=u.current)===null||l===void 0||l.call(u),d(n,{data:f,params:e.state.params,time:new Date().getTime()}),u.current=$(n,function(m){e.setState({data:m})}))}}:{}};const ue=te;var ie=function(e,r){var n=r.debounceWait,t=r.debounceLeading,i=r.debounceTrailing,a=r.debounceMaxWait,o=React.useRef(),c=React.useMemo(function(){var s={};return t!==void 0&&(s.leading=t),i!==void 0&&(s.trailing=i),a!==void 0&&(s.maxWait=a),s},[t,i,a]);return React.useEffect(function(){if(n){var s=e.runAsync.bind(e);return o.current=J(function(u){u()},n,c),e.runAsync=function(){for(var u=[],v=0;v<arguments.length;v++)u[v]=arguments[v];return new Promise(function(d,h){var f;(f=o.current)===null||f===void 0||f.call(o,function(){s.apply(void 0,g([],p(u),!1)).then(d).catch(h)})})},function(){var u;(u=o.current)===null||u===void 0||u.cancel(),e.runAsync=s}}},[n,c]),n?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}};const ae=ie;var oe=function(e,r){var n=r.loadingDelay,t=r.ready,i=React.useRef();if(!n)return{};var a=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return a(),t!==!1&&(i.current=setTimeout(function(){e.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){a()},onCancel:function(){a()}}};const se=oe;var D=!!(typeof window<"u"&&window.document&&window.document.createElement);function B(){return D?document.visibilityState!=="hidden":!0}var T=[];function ce(e){return T.push(e),function(){var n=T.indexOf(e);T.splice(n,1)}}if(D){var fe=function(){if(B())for(var e=0;e<T.length;e++){var r=T[e];r()}};window.addEventListener("visibilitychange",fe,!1)}var le=function(e,r){var n=r.pollingInterval,t=r.pollingWhenHidden,i=t===void 0?!0:t,a=r.pollingErrorRetryCount,o=a===void 0?-1:a,c=React.useRef(),s=React.useRef(),u=React.useRef(0),v=function(){var d;c.current&&clearTimeout(c.current),(d=s.current)===null||d===void 0||d.call(s)};return L(function(){n||v()},[n]),n?{onBefore:function(){v()},onError:function(){u.current+=1},onSuccess:function(){u.current=0},onFinally:function(){o===-1||o!==-1&&u.current<=o?c.current=setTimeout(function(){!i&&!B()?s.current=ce(function(){e.refresh()}):e.refresh()},n):u.current=0},onCancel:function(){v()}}:{}};const de=le;function ve(e,r){var n=!1;return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n||(n=!0,e.apply(void 0,g([],p(t),!1)),setTimeout(function(){n=!1},r))}}function he(){return D&&typeof navigator.onLine<"u"?navigator.onLine:!0}var S=[];function me(e){return S.push(e),function(){var n=S.indexOf(e);n>-1&&S.splice(n,1)}}if(D){var N=function(){if(!(!B()||!he()))for(var e=0;e<S.length;e++){var r=S[e];r()}};window.addEventListener("visibilitychange",N,!1),window.addEventListener("focus",N,!1)}var ge=function(e,r){var n=r.refreshOnWindowFocus,t=r.focusTimespan,i=t===void 0?5e3:t,a=React.useRef(),o=function(){var c;(c=a.current)===null||c===void 0||c.call(a)};return React.useEffect(function(){if(n){var c=ve(e.refresh.bind(e),i);a.current=me(function(){c()})}return function(){o()}},[n,i]),j(function(){o()}),{}};const pe=ge;var Re=function(e,r){var n=r.retryInterval,t=r.retryCount,i=React.useRef(),a=React.useRef(0),o=React.useRef(!1);return t?{onBefore:function(){o.current||(a.current=0),o.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){a.current=0},onError:function(){if(a.current+=1,t===-1||a.current<=t){var c=n??Math.min(1e3*Math.pow(2,a.current),3e4);i.current=setTimeout(function(){o.current=!0,e.refresh()},c)}else a.current=0},onCancel:function(){a.current=0,i.current&&clearTimeout(i.current)}}:{}};const be=Re;var ye=function(e,r){var n=r.throttleWait,t=r.throttleLeading,i=r.throttleTrailing,a=React.useRef(),o={};return t!==void 0&&(o.leading=t),i!==void 0&&(o.trailing=i),React.useEffect(function(){if(n){var c=e.runAsync.bind(e);return a.current=K(function(s){s()},n,o),e.runAsync=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return new Promise(function(v,d){var h;(h=a.current)===null||h===void 0||h.call(a,function(){c.apply(void 0,g([],p(s),!1)).then(v).catch(d)})})},function(){var s;e.runAsync=c,(s=a.current)===null||s===void 0||s.cancel()}}},[n,t,i]),n?{onCancel:function(){var c;(c=a.current)===null||c===void 0||c.cancel()}}:{}};const Pe=ye;var we=function(e){React.useEffect(function(){e?.()},[])},Ce=function(){var e=p(React.useState({}),2),r=e[1];return React.useCallback(function(){return r({})},[])},Te=function(){function e(r,n,t,i){i===void 0&&(i={}),this.serviceRef=r,this.options=n,this.subscribe=t,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=R(R(R({},this.state),{loading:!n.manual}),i)}return e.prototype.setState=function(r){r===void 0&&(r={}),this.state=R(R({},this.state),r),this.subscribe()},e.prototype.runPluginHandler=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var i=this.pluginImpls.map(function(a){var o;return(o=a[r])===null||o===void 0?void 0:o.call.apply(o,g([a],p(n),!1))}).filter(Boolean);return Object.assign.apply(Object,g([{}],p(i),!1))},e.prototype.runAsync=function(){for(var r,n,t,i,a,o,c,s,u,v,d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];return V(this,void 0,void 0,function(){var f,l,m,E,M,H,W,A,b,y,x;return q(this,function(C){switch(C.label){case 0:if(this.count+=1,f=this.count,l=this.runPluginHandler("onBefore",d),m=l.stopNow,E=m===void 0?!1:m,M=l.returnNow,H=M===void 0?!1:M,W=_(l,["stopNow","returnNow"]),E)return[2,new Promise(function(){})];if(this.setState(R({loading:!0,params:d},W)),H)return[2,Promise.resolve(W.data)];(n=(r=this.options).onBefore)===null||n===void 0||n.call(r,d),C.label=1;case 1:return C.trys.push([1,3,,4]),A=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,A||(A=(x=this.serviceRef).current.apply(x,g([],p(d),!1))),[4,A];case 2:return b=C.sent(),f!==this.count?[2,new Promise(function(){})]:(this.setState({data:b,error:void 0,loading:!1}),(i=(t=this.options).onSuccess)===null||i===void 0||i.call(t,b,d),this.runPluginHandler("onSuccess",b,d),(o=(a=this.options).onFinally)===null||o===void 0||o.call(a,d,b,void 0),f===this.count&&this.runPluginHandler("onFinally",d,b,void 0),[2,b]);case 3:if(y=C.sent(),f!==this.count)return[2,new Promise(function(){})];throw this.setState({error:y,loading:!1}),(s=(c=this.options).onError)===null||s===void 0||s.call(c,y,d),this.runPluginHandler("onError",y,d),(v=(u=this.options).onFinally)===null||v===void 0||v.call(u,d,void 0,y),f===this.count&&this.runPluginHandler("onFinally",d,void 0,y),y;case 4:return[2]}})})},e.prototype.run=function(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.runAsync.apply(this,g([],p(n),!1)).catch(function(i){r.options.onError})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,g([],p(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,g([],p(this.state.params||[]),!1))},e.prototype.mutate=function(r){var n=X(r)?r(this.state.data):r;this.runPluginHandler("onMutate",n),this.setState({data:n})},e}();const Se=Te;function Ee(e,r,n){r===void 0&&(r={}),n===void 0&&(n=[]);var t=r.manual,i=t===void 0?!1:t,a=_(r,["manual"]),o=R({manual:i},a),c=G(e),s=Ce(),u=U(function(){var v=n.map(function(d){var h;return(h=d?.onInit)===null||h===void 0?void 0:h.call(d,o)}).filter(Boolean);return new Se(c,o,s,Object.assign.apply(Object,g([{}],p(v),!1)))},[]);return u.options=o,u.pluginImpls=n.map(function(v){return v(u,o)}),we(function(){if(!i){var v=u.state.params||r.defaultParams||[];u.run.apply(u,g([],p(v),!1))}}),j(function(){u.cancel()}),{loading:u.state.loading,data:u.state.data,error:u.state.error,params:u.state.params||[],cancel:w(u.cancel.bind(u)),refresh:w(u.refresh.bind(u)),refreshAsync:w(u.refreshAsync.bind(u)),run:w(u.run.bind(u)),runAsync:w(u.runAsync.bind(u)),mutate:w(u.mutate.bind(u))}}function Fe(e,r,n){return Ee(e,r,g(g([],p(n||[]),!1),[ae,se,de,pe,Pe,Y,ue,be],!1))}export{Fe as u};
